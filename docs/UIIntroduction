C–∞–º–º–∞—Ä–∏ –¥–ª—è UI

## 1) –ï–¥–∏–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã (shared)

* **Types.lua** (`src/shared/Modules/Types.lua`)
  –≠–Ω–∞–º—ã –∏ —Ç–∏–ø—ã: `Rarity`, `Class`, `LootboxState`, `ProfileV2`, `CollectionEntry`, `Deck`, `LootboxEntry`, —Å–µ—Ç–µ–≤—ã–µ payload‚Äô—ã (`ProfileUpdatedPayload`, `MatchResponse`).
  üëâ –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è —Ñ–æ—Ä–º –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ.
* **BoardLayout.lua** (`src/shared/Modules/BoardLayout.lua`)
  –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∞—è —Å–µ—Ç–∫–∞ 3√ó2 –∏ —Å–ª–æ—Ç—ã: –≤–∏–∑—É–∞–ª—å–Ω–æ `5 3 1 / 6 4 2`.
  –•–µ–ª–ø–µ—Ä—ã: `gridForDeck(deck)`, `SLOT_ORDER()` (—Ö–æ–¥—ã 1‚Üí6), `oppositeSlot(slot)`.
* **TimeUtils.lua** (`src/shared/Modules/TimeUtils.lua`)
  `nowUnix()`, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –ª—É—Ç–±–æ–∫—Å–æ–≤, –±–∞–∑–æ–≤—ã–µ time-—Ö–µ–ª–ø–µ—Ä—ã.
  –ü–ª—é—Å: **`serverNow` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–µ–∑–∂–∞–µ—Ç –≤–æ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞** (–∏ –≤ `ProfileUpdated`, –∏ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ `RequestStartMatch`) ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è —Ç–∞–π–º–µ—Ä–æ–≤ –±–µ–∑ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∞.
* **ErrorMap.lua** (`src/shared/Modules/ErrorMap.lua`)
  `code ‚Üí {title, message}` + `toUserMessage(code, fallback?)` –¥–ª—è –µ–¥–∏–Ω—ã—Ö —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã—Ö –æ—à–∏–±–æ–∫.

## 2) –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–ª–æ–π (–≥–æ—Ç–æ–≤—ã–µ ¬´–∫—Ä—é—á–∫–∏¬ª –¥–ª—è UI)

* **NetworkClient** (`src/client/Controllers/NetworkClient.client.lua`)
  –ú–µ—Ç–æ–¥—ã:
  `requestProfile()`, `requestSetDeck(deckIds)`, `requestStartMatch(opts)`, —Å–æ–±—ã—Ç–∏—è: `onProfileUpdated(cb)`, `onceProfile(cb)`.
  –í—à–∏—Ç—ã: –¥–µ–±–∞—É–Ω—Å, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ ErrorMap, —Ç—Ä–µ–∫–∏–Ω–≥ `serverNow`.
* **ClientState** (`src/client/State/ClientState.client.lua`)
  –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–æ—Ä: –ø—Ä–æ—Ñ–∏–ª—å v2, `serverNow`, —Ñ–ª–∞–≥–∏ UI-—Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø–æ—Å–ª–µ–¥–Ω–∏–π error. –ê–≤—Ç–æ–º–µ—Ä–¥–∂ —Å–Ω–∞–ø—à–æ—Ç–æ–≤ –∏–∑ `ProfileUpdated`.
* **selectors.lua** (`src/client/State/selectors.lua`)
  –ß–∏—Å—Ç—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã: –ø–æ–ª—É—á–∏—Ç—å –¥–µ–∫—É, –∫–æ–ª–ª–µ–∫—Ü–∏—é —Å–ø–∏—Å–∫–æ–º (—Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞–º–∏: –ø–æ –∏–º–µ–Ω–∏/—Ä–µ–¥–∫–æ—Å—Ç–∏/—É—Ä–æ–≤–Ω—é/slotNumber), –≤–∞–ª—é—Ç—ã, –ª—É—Ç–±–æ–∫—Å—ã –∏ —Ç.–¥.
* **ViewModels** (`src/shared/Modules/ViewModels/`)

  * `CardVM.build(cardId, entry?) ‚Üí { id, name, rarity, class, level, stats, power, slotNumber, description }`
  * `DeckVM.build(deckIds, collection) ‚Üí { slots[{slot,row,col,card}], squadPower }`
  * `ProfileVM.build(profile) ‚Üí { deckVM, collectionVM[], lootboxes[], currencies, loginInfo, squadPower }`
    üëâ UI –ø–æ–ª—É—á–∞–µ—Ç ¬´–≥–æ—Ç–æ–≤—ã–µ –∫ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ¬ª —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–µ–∑ –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏.

## 3) –ê—Å—Å–µ—Ç—ã, –º–æ–∫–∏, –∫–æ–Ω—Ñ–∏–≥–∏, –¥–µ–≤-–ø–∞–Ω–µ–ª—å

* **Assets Manifest** (`src/shared/Modules/Assets/Manifest.lua`) + **Resolver**
  `Resolver.getCardImage(cardId)`, `getClassIcon(class)`, `getRarityFrame(rarity)`, `getRarityColor(rarity)` ‚Äî —Å —Ñ–æ–ª–±—ç–∫–∞–º–∏.
* **Config.lua** (`src/client/Config.lua`)
  –§–ª–∞–≥–∏:
  `USE_MOCKS` (–º–æ–∫–∏ –≤–º–µ—Å—Ç–æ —Å–µ—Ä–≤–µ—Ä–∞), `SHOW_DEV_PANEL` (–ø–æ–∫–∞–∑–∞—Ç—å –¥–µ–≤-–ø–∞–Ω–µ–ª—å),
  `DEBUG_LOGS`, `AUTO_REQUEST_PROFILE` (–∞–≤—Ç–æ-–∑–∞–ø—Ä–æ—Å –ø—Ä–æ—Ñ–∏–ª—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ).
* **MockData / MockNetwork** (`src/client/Dev/`)
  –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º: –º–æ–∫–æ–≤—ã–µ `ProfileUpdated`/–º–∞—Ç—á–∏, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –ø–æ —Å—Ö–µ–º–µ, —Å `serverNow`. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–µ—Ä—Å—Ç–∞—Ç—å UI –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞.
* **DevPanel** (`src/client/Dev/DevPanel.client.lua`)
  –ù–µ–±–æ–ª—å—à–∞—è –ø–∞–Ω–µ–ª—å–∫–∞ (ScreenGui):

  * Refresh Profile
  * Set Sample Deck (6 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç)
  * Start PvE
  * Toggle Mocks (–≥–æ—Ä—è—á–µ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Ñ—Ñ–ª–∞–π–Ω/–æ–Ω–ª–∞–π–Ω —Å —Ä–µ-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π)
    –ü–ª—é—Å —Å—Ç–∞—Ç—É—Å: `serverNow`, `squadPower`, Mock ON/OFF.

---

# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è UI-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

1. **–í–∫–ª—é—á–∏—Ç—å –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º (–ø–æ –∂–µ–ª–∞–Ω–∏—é):**
   –í `Config.lua`:

   ```lua
   USE_MOCKS = true
   SHOW_DEV_PANEL = true
   AUTO_REQUEST_PROFILE = true
   ```

   –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É ‚Äî –ø–∞–Ω–µ–ª—å –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É. –ï—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª—å, –∫–æ–ª–ª–µ–∫—Ü–∏—è, –¥–µ–∫–∞, —Ç–∞–π–º–µ—Ä—ã –ª—É—Ç–±–æ–∫—Å–æ–≤ (–Ω–∞ –º–æ–∫–∞—Ö).
2. **–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ VM:**

   ```lua
   local Utilities = require(ReplicatedStorage.Modules.Utilities)
   local NetworkClient = require(StarterPlayer.StarterPlayerScripts.Controllers.NetworkClient)
   local ClientState = require(StarterPlayer.StarterPlayerScripts.State.ClientState)
   local ProfileVM = Utilities.ViewModels.ProfileVM

   ClientState.init(NetworkClient)
   NetworkClient.requestProfile()

   -- –≥–¥–µ-–Ω–∏–±—É–¥—å –≤ –≤–∞—à–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ/—Ä–æ—É—Ç–µ—Ä–µ:
   local state = ClientState.getState()
   if state.profile then
     local vm = ProfileVM.build(state.profile)
     -- vm.deckVM.slots ‚Üí –¥–ª—è –≥—Ä–∏–¥-—Ä–µ–Ω–¥–µ—Ä–∞ (row/col/slot/–∫–∞—Ä—Ç–∞)
     -- vm.collectionVM ‚Üí —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ —Å level/stats/power
     -- vm.lootboxes ‚Üí –¥–ª—è —Ç–∞–π–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ serverNow –∏–∑ state
   end
   ```
3. **–ú–µ–Ω—è–µ–º –¥–µ–∫—É:**
   –°–æ–±–µ—Ä–∏—Ç–µ **6 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö** `cardId` ‚Üí `NetworkClient.requestSetDeck(deckIds)` ‚Üí –ª–æ–≤–∏—Ç–µ `ProfileUpdated` ‚Üí –≤ —Å—Ç–µ–π—Ç–µ –ø–æ—è–≤–∏—Ç—Å—è –Ω–æ–≤—ã–π `squadPower`.
   –ü–æ–∑–∏—Ü–∏–∏ –Ω–∞ –ø–æ–ª–µ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è **–ø–æ `slotNumber`** –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ (—Å–µ—Ä–≤–µ—Ä), –ø—Ä–µ–≤—å—é –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å `DeckVM.build(...)`.
4. **–ú–∞—Ç—á (–¥–ª—è —Ç–µ—Å—Ç–∞):**
   `NetworkClient.requestStartMatch({ mode = "PvE" })` ‚Üí –ø–æ–ª—É—á–∏—Ç–µ `{ ok, result, log, serverNow }` –∏ –ø–æ–∫–∞–∂–∏—Ç–µ —Ä–µ–∑—é–º–µ –±–æ—è.
5. **–ê—Å—Å–µ—Ç—ã:**

   ```lua
   local Assets = Utilities.Assets
   local img = Assets.Resolver.getCardImage(cardId)
   local color = Assets.Resolver.getRarityColor("Epic")
   ```

---

# –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã (–∫–æ—Ä–æ—Ç–∫–æ)

* **serverNow** –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ `ProfileUpdated` –∏ –æ—Ç–≤–µ—Ç–µ –º–∞—Ç—á–∞ ‚Üí —Ç–∞–π–º–µ—Ä—ã —Å—á–∏—Ç–∞—é—Ç ¬´–æ—Ç —Å–µ—Ä–≤–µ—Ä–∞¬ª.
* **–î–µ–∫–∞**: –≤—Å–µ–≥–¥–∞ 6 **—É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö** –∫–∞—Ä—Ç, –ø–æ—Ä—è–¥–æ–∫ —Ö–æ–¥–æ–≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω 1‚Üí6; —Ä–∞—Å–∫–ª–∞–¥–∫–∞ (–≥–¥–µ —á—å—è –∫–∞—Ä—Ç–∞ —Å—Ç–æ–∏—Ç) –∑–∞–¥–∞—ë—Ç—Å—è **`slotNumber`**.
* **–°–µ—Ç–∫–∞ –±–æ—Ä–¥–∞**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `BoardLayout.gridForDeck` (–≤–∏–∑—É–∞–ª—å–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ `5 3 1 / 6 4 2`).
* **–û—à–∏–±–∫–∏** –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ `ErrorMap.toUserMessage(code)` ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –≥–æ—Ä–æ–¥–∏—Ç—å —Ä–∞–∑–Ω–æ–±–æ–π.
* **ViewModels** –∏ **selectors** ‚Äî —á–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –±–µ–∑ —Å–∞–π–¥-—ç—Ñ—Ñ–µ–∫—Ç–æ–≤, –∏—Ö –º–æ–∂–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –≤ React-–ø–æ–¥–æ–±–Ω–æ–º UI.

---

# –ì–¥–µ –ª–µ–∂–∏—Ç —á—Ç–æ (–±—ã—Å—Ç—Ä—ã–π –ø—É—Ç–µ–≤–æ–¥–∏—Ç–µ–ª—å)

* Shared –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã/—É—Ç–∏–ª–∏—Ç—ã: `src/shared/Modules/{Types, BoardLayout, TimeUtils, ErrorMap}`
* –ê—Å—Å–µ—Ç—ã: `src/shared/Modules/Assets/{Manifest, Resolver}`
* Card/Deck/Stats/Levels: `src/shared/Modules/Cards/{CardCatalog, DeckValidator, CardStats, CardLevels}`
* VM: `src/shared/Modules/ViewModels/{CardVM, DeckVM, ProfileVM}`
* –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–ª–æ–π: `src/client/{Controllers/NetworkClient.client.lua, State/*, Dev/*, Config.lua}`
